#!/bin/bash

modtable(){
  ./newmod.sh.txt "$1" \
  | while read localmodule; do
      echo " <hbox space-expand=\"false\">"
      echo "  <text space-expand=\"true\"><label>$localmodule</label></text>"
      echo "  <checkbox space-expand=\"false\">"
      echo "   <label>заменить на</label>"
      echo "   <variable>CHECK_$localmodule</variable>"
      echo "  </checkbox>"
      echo "  <comboboxtext space-expand=\"true\" space-fill=\"true\">"
      echo "   <variable>LIST_$localmodule</variable>"
      while read repomodule && [ "$repomodule" != "-----" ]; do
        echo " <item>$repomodule</item>"
      done
      echo "  </comboboxtext>"
      echo " </hbox>"
    done
}

export MAIN_DIALOG="
<window>
<vbox>
  <hbox space-expand=\"true\">
    <text><label>Новые модули</label></text>
  </hbox>
  $(modtable "$1")
  <hbox space-expand=\"true\">
    <button ok></button>
    <button cancel></button>
  </hbox>
</vbox>
</window>
"

gtkdialog -p MAIN_DIALOG
